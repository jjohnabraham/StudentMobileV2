<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button class="pec-back-button" [text]="''" [icon]="''"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <div>Assignment Overview</div>
      <div class="subtitle" *ngIf="assignment">
        {{ assignment.AssignmentName }}
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>
<ion-content [forceOverscroll]="false">
  <pec-loading *ngIf="showLoading || !assignmentOverview"></pec-loading>
  <ng-container *ngIf="!showLoading && assignment && assignmentOverview">
    <ion-card
      *ngIf="assignment && assignment.AssignmentTypeId === 3 && assignmentModelOverview"
      class="group-project-card"
    >
      <ion-card-header>
        <span>GROUP COLLABORATION</span>
        <p *ngIf="assignmentModelOverview.AssignmentDetails[0].GroupName">
          <span class="group-name">My Group: {{ assignmentModelOverview.AssignmentDetails[0].GroupName }}</span>
        </p>
      </ion-card-header>
      <ion-grid *ngIf="assignmentOverview && assignmentModelOverview">
        <div *ngIf="assignmentModelOverview.AssignmentDetails[0].GroupName">
          <div
            [class.show]="showLess"
            [ngClass]="{ container: assignmentModelOverview.AssignmentDetails[0].GroupMembersSubmissions.length > 3 }"
          >
            <div *ngIf="activeMemberList">
              <div *ngFor="let name of activeMemberList">
                <ion-row>
                  <ion-col class="course-description member-name">{{ name.FirstName }} {{ name.LastName }}</ion-col>
                </ion-row>
              </div>
            </div>
            <div *ngIf="inactiveMemberList">
              <div *ngFor="let inactiveMember of inactiveMemberList">
                <ion-row>
                  <ion-col class="non-active-member member-name">
                    {{ inactiveMember.FirstName }} {{ inactiveMember.LastName }} (no longer active)
                  </ion-col>
                </ion-row>
              </div>
            </div>
          </div>

          <ion-row
            *ngIf="
              assignmentModelOverview.AssignmentDetails[0].GroupMembersSubmissions &&
              assignmentModelOverview.AssignmentDetails[0].GroupMembersSubmissions.length > 3
            "
          >
            <ion-col>
              <label class="show-more-label" (click)="showLess = !showLess">
                {{ showLess ? 'Show Less' : 'Show More' }}
              </label>
            </ion-col>
          </ion-row>
        </div>
        <ion-row
          *ngIf="
            !assignmentModelOverview.AssignmentDetails[0].GroupMembersSubmissions ||
            assignmentModelOverview.AssignmentDetails[0].GroupMembersSubmissions.length == 0 ||
            !assignmentModelOverview.AssignmentDetails[0].GroupName
          "
        >
          <ion-col>
            <p class="no-group-assigned">You have not been assigned to a group yet.</p>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-button
              [routerLink]="['../../group-live-chats']"
              [state]="{ assignment: assignment, classId: classId }"
              [pecTrackEvent]="{
                category: 'Assignment Overview',
                action: 'Tapped to View Group Live Chats',
                label: '',
                value: '',
                classId: classId
              }"
              class="pec-button-grey pec-w-100"
            >
              GROUP LIVE CHATS
            </ion-button>
          </ion-col>
          <ion-col>
            <ion-button
              (click)="$event.stopPropagation()"
              [routerLink]="['/tabs/home/discussion-board', classId, assignment.AssignmentId]"
              [pecTrackEvent]="{
                category: 'Assignment Overview',
                action: 'Tapped Assignment Work Area',
                label: 'Discussion Board',
                value: '',
                classId: classId
              }"
              class="pec-button-grey pec-w-100"
            >
              DISCUSSION BOARD
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <span>ASSIGNMENT DESCRIPTION</span>
      </ion-card-header>
      <ion-grid *ngIf="assignmentOverview && classInfo">
        <ion-row *ngIf="assignmentOverview.AssignmentDetails[0].DeliverableLength">
          <ion-col class="deliverable-length">
            Deliverable Length:
            <p>{{ assignmentOverview.AssignmentDetails[0].DeliverableLength }}</p>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="assignmentOverview.AssignmentDetails[0].LCMSInstructions">
          <ion-col class="instructions">
            Instructions:
            <p>{{ assignmentOverview.AssignmentDetails[0].LCMSInstructions }}</p>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="!isNewCustomCourse">
          <ion-col>
            <ion-button
              [routerLink]="['../../assignment-objectives', assignmentOverview.AssignmentDetails[0].AssignmentId]"
              [state]="{ assignment: assignmentOverview.AssignmentDetails[0] }"
              [pecTrackEvent]="{
                category: 'Assignment Overview',
                action: 'Tapped to View Assignment Objectives',
                label: '',
                value: '',
                classId: classId
              }"
              class="pec-button-grey pec-w-100"
            >
              OBJECTIVES
            </ion-button>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col *ngIf="assignmentOverview" class="course-description">
            <p *ngIf="isNewCustomCourse" class="details-header">ASSIGNMENT DETAILS</p>
            <div [innerHtml]="assignmentOverview.AssignmentDetails[0].Description | pecSafeHtml"></div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card>

    <ion-card *ngIf="assignmentOverview">
      <ion-card-header>
        <span *ngIf="isNewCustomCourse">INSTRUCTOR'S COMMENTS</span>
        <span *ngIf="!isNewCustomCourse">OTHER INFORMATION</span>
      </ion-card-header>
      <ion-grid>
        <ion-row *ngIf="!assignmentOverview.AssignmentDetails[0].InstructorComments">
          <ion-col *ngIf="isNewCustomCourse">There are no instructor comments to display at this time.</ion-col>
          <ion-col *ngIf="!isNewCustomCourse">There is no additional information to display at this time.</ion-col>
        </ion-row>
        <ion-row *ngIf="assignmentOverview.AssignmentDetails[0].InstructorComments">
          <ion-col>
            <b *ngIf="!isNewCustomCourse">Instructor's Comments:</b>
            <div [innerHTML]="assignmentOverview.AssignmentDetails[0].InstructorComments"></div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card>

    <ion-card *ngIf="classInfo">
      <ion-card-header>
        <span>NEED HELP?</span>
      </ion-card-header>
      <ion-row>
        <ion-col>
          <pec-contact-box
            [trackEvent]="{
              category: 'Assignment Overview',
              action: 'Tapped to View Contact',
              label: 'Instructor',
              value: '',
              classId: classInfo.ClassId
            }"
            [contactInfo]="{
              SourceSystem: classInfo.SourceSystemId,
              SyStaffId: classInfo.StaffId,
              EmailAddress: classInfo.PrimaryInstructorEmail,
              ContactGroup: 'Instructor',
              DisplayName: 'FACULTY',
              Name: classInfo.PrimaryInstructor,
              Phone: classInfo.PrimaryInstructorPhone,
              SendBirdChatUserId: classInfo.PrimaryInstructorSendBirdId,
              ClassId: classInfo.ClassId,
              IsDepartment: false
            }"
          ></pec-contact-box>
        </ion-col>
      </ion-row>
    </ion-card>

    <div>
      <pec-smarthinking-tips-card [trackView]="'Assignment Overview'" [classId]="classId"></pec-smarthinking-tips-card>
    </div>
  </ng-container>
</ion-content>
