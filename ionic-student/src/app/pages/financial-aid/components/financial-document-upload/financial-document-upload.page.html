<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button
        class="pec-back-button"
        [text]="''"
        [icon]="''"
        (click)="onBack()"
        [defaultHref]="previousView"
      ></ion-back-button>
    </ion-buttons>
    <ion-title>
      <div>Upload a Document</div>
      <div class="subtitle" *ngIf="documentUploadName">{{ documentUploadName }}</div>
    </ion-title>
  </ion-toolbar>
</ion-header>
<ion-content forceOverscroll="false" [class.error-page]="showError" [pecTrackView]="{ view: 'Upload Document View' }">
  <ng-container *ngIf="!showError">
    <ion-card class="pec-contact-card pec-upload-docs-card">
      <ng-container>
        <ion-card-header class="pec-fs-12 pec-bc-divider pec-pt-15 pec-pb-14 pec-px-12">
          <span>Send Us {{ documentUploadName ? documentUploadName : 'a Document' }} in Just a Few Taps</span>
        </ion-card-header>
        <ion-card-content class="pec-px-12 pec-pt-0 pec-fs-14">
          <ol>
            <li>
              Begin by tapping
              <strong>Select File(s)</strong>
            </li>
            <li>
              Use your camera to take a picture of your document or select existing files from your device or cloud
              drive
            </li>
            <li *ngIf="!documentId">Add comments and/or select more files</li>
            <li *ngIf="documentId">Select more files if necessary</li>
            <li>
              Tap
              <strong>Send</strong>
              to send the document
            </li>
          </ol>

          <pec-multi-file-upload id="multi-file-upload" [label]="'SELECT FILE(S)'"></pec-multi-file-upload>

          <div class="pec-text-dove-gray pec-fs-12 pec-mt-20 pec-mb-8 pec-text-center">
            <span class="pec-font-default-semibold">Maximum upload size:</span>
            <span *ngIf="fileField?.uploader?.queue?.length">
              <span class="pec-font-default-semibold pec-text-warning">
                {{ 15 - fileField?.uploadedFileSize | number: '1.2-2' }}MB
              </span>
              /
            </span>
            15MB
            <span *ngIf="fileField?.uploader?.queue?.length">left</span>
            <br />
            <span class="pec-font-default-semibold">Acceptable file types:</span>
            <br />
            GIF, JPG, PDF, BMP, DOC, DOCX, RTF, and PNG
          </div>
        </ion-card-content>
      </ng-container>
    </ion-card>

    <ion-card *ngIf="fileField?.uploadedFiles?.length && fileField" class="pec-contact-card pec-upload-send-card">
      <ng-container>
        <ion-card-header class="smaller-header">
          <span class="number-documents">{{ fileField.uploadedFiles?.length }}</span>
          File(s) Ready to be Sent
        </ion-card-header>
        <ion-card-content class="pec-px-12">
          <ion-list class="pec-file-upload-list pec-py-12 pec-pb-0">
            <ion-item class="pec-d-flex" *ngFor="let item of fileField.uploadedFiles">
              <ion-row class="pec-w-100">
                <ion-col size="9" class="pec-pl-0">
                  <div
                    class="file-wrapper pec-d-flex-grow-1 pec-px-5 pec-py-2 pec-fs-12 pec-text-tr-up pec-d-flex-grow-1"
                  >
                    <div class="file-name pec-font-body pec-fw-600 pec-fs-12">
                      <span>{{ item?.file?.name }}</span>
                    </div>
                    <div class="file-size text-instr-soft pec-text-grey">
                      {{ item?.file?.size / (1024 * 1024) | number: '1.2-2' }}MB
                    </div>
                    <div>
                      <div *ngIf="item?.file?.imgUrl" class="myCard" (click)="presentUploadModal(item.file.name)">
                        <img *ngIf="item?.file?.imgUrl" [src]="sanitizer.bypassSecurityTrustUrl(item?.file?.imgUrl)" />

                        <div class="myOverlay">Tap to preview</div>
                      </div>

                      <p *ngIf="!item?.file?.imgUrl">Preview is not available for the file type selected</p>
                    </div>
                  </div>
                </ion-col>
                <ion-col size="3" class="pec-pr-0">
                  <ion-button
                    [ngClass]="globalConfig.themeId === 18 ? 'remove-button-theme-18' : 'remove-button-theme-9'"
                    fill="clear"
                    (click)="showAlert(item)"
                    [pecTrackEvent]="{
                      category: 'Upload Document',
                      action: 'Tapped to Remove a File',
                      label: '',
                      value: ''
                    }"
                  >
                    Remove
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-item>
          </ion-list>

          <form [formGroup]="sendDocuments" (ngSubmit)="submitSendDocuments()" novalidate>
            <ng-container *ngIf="!documentId">
              <ion-textarea
                type="text"
                name="CommentsText"
                formControlName="commentsText"
                [ngClass]="'upload-textarea'"
                #commentstext
                (keyup)="charCount = commentstext.value"
                placeholder="Tap to enter comments"
                rows="3"
                maxlength="500"
              ></ion-textarea>
              <span class="char-count-upload" *ngIf="charCount">{{ charCount | pecTextCountdown: 500 }} left</span>
            </ng-container>
            <ion-row>
              <ion-col class="button-add-col">
                <ion-button
                  [ngClass]="
                    globalConfig.themeId === 18
                      ? 'pec-button-blue pec-text-tr-up'
                      : 'pec-button-red pec-text-tr-up button-col'
                  "
                  (click)="multiFileUpload()"
                >
                  ADD MORE
                </ion-button>
              </ion-col>
              <ion-col class="button-send-col">
                <ion-button
                  [ngClass]="
                    globalConfig.themeId === 18
                      ? 'pec-button-blue pec-text-tr-up'
                      : 'pec-button-red pec-text-tr-up button-col'
                  "
                  type="submit"
                >
                  Send
                </ion-button>
              </ion-col>
            </ion-row>
          </form>
        </ion-card-content>
      </ng-container>
    </ion-card>

    <pec-financial-aid-advisor
      [eventCategory]="'Upload Document'"
      (errorOnLoad)="onError($event)"
    ></pec-financial-aid-advisor>
  </ng-container>
  <ng-container *ngIf="showError">
    <pec-error-api [errorDetails]="errorCodeMessage"></pec-error-api>
  </ng-container>
</ion-content>
