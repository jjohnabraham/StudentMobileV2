<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button class="pec-back-button" [text]="''" [icon]="''"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <div>Employment</div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content forceOverscroll="false" [pecTrackView]="{ view: 'Employment View' }">
  <ion-refresher (ionRefresh)="doRefresh($event)" slot="fixed">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <pec-loading *ngIf="showLoading"></pec-loading>
  <ng-container *ngIf="!showLoading">
    <ion-card data-cecname="employment-status-card" class="employment-status-card">
      <ion-card-header class="standard-header">
        <span class="ion-text-uppercase">Are you currently employed?</span>
      </ion-card-header>
      <ion-grid class="employment-status-grid">
        <ion-row>
          <ion-col>
            <ion-item class="pec-form-input">
              <ion-select
                placeholder="Please select an option"
                class="pec-dropdown"
                [(ngModel)]="employmentStatus"
                [interfaceOptions]="{
                  header: 'Are you currently employed?',
                  backdropDismiss: true,
                  cssClass: 'action-sheet-no-cancel'
                }"
                [interface]="'action-sheet'"
                (ngModelChange)="this.globalConfigs.requireNavigationConfirmation = true"
              >
                <ion-select-option value="yes">Yes</ion-select-option>
                <ion-select-option value="no">No</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="employmentStatus === 'no'" class="submit-button-row">
          <ion-col>
            <ion-button
              class="pec-button-grey"
              type="button"
              (click)="submitEmploymentDetails()"
              [pecTrackEvent]="{ category: 'Employment View', action: 'Tapped Submit Status', label: '', value: '' }"
            >
              Submit
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card>

    <ion-card data-cecname="employment-details-card" *ngIf="employmentStatus === 'yes'">
      <ion-card-header class="standard-header border-bottom space-between">
        <span class="ion-text-uppercase">Employment Details</span>
        <span class="text-muted">(All fields required)</span>
      </ion-card-header>
      <ion-grid class="employment-details-grid">
        <form [formGroup]="employmentDetailsForm">
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('EmployerName') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label">Employer Name</label>
                <label class="pec-input-label text-muted pec-label-error" *ngIf="hasError('EmployerName', 'required')">
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input">
                <ion-input type="text" formControlName="EmployerName" maxlength="50"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('EmployerStreetAddress') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label">Employer Street Address</label>
                <label
                  class="pec-input-label text-muted pec-label-error"
                  *ngIf="hasError('EmployerStreetAddress', 'required')"
                >
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input">
                <ion-input type="text" formControlName="EmployerStreetAddress" maxlength="250"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('EmployerCity') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label">Employer City</label>
                <label class="pec-input-label text-muted pec-label-error" *ngIf="hasError('EmployerCity', 'required')">
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input">
                <ion-input type="text" formControlName="EmployerCity" maxlength="50"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('SystateId') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label">Employer State</label>
                <label class="pec-input-label text-muted pec-label-error" *ngIf="hasError('SystateId', 'required')">
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input">
                <ion-select
                  placeholder="Please select an option"
                  class="pec-dropdown"
                  formControlName="SystateId"
                  [interfaceOptions]="{ header: 'Employment State' }"
                  [interface]="'alert'"
                >
                  <ion-select-option [value]="state.systateId" *ngFor="let state of usStates">
                    {{ state.name }}
                  </ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('EmployerZip') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label">Employer Zip</label>
                <label class="pec-input-label text-muted pec-label-error" *ngIf="hasError('EmployerZip', 'required')">
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input">
                <ion-input type="text" inputmode="numeric" formControlName="EmployerZip" maxlength="5"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('WorkPhone') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label">Work Phone</label>
                <label class="pec-input-label text-muted pec-label-error" *ngIf="hasError('WorkPhone', 'required')">
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input">
                <ion-input
                  type="tel"
                  formControlName="WorkPhone"
                  pecPhoneFormat
                  maxlength="14"
                  placeholder="( ___ ) ___ - ____"
                ></ion-input>
              </ion-item>
              <div id="extnInputWrapper" [ngClass]="{ 'invalid-scroll-anchor': hasError('WorkPhoneExtn') }">
                <label class="text-muted" for="extnInput" [ngClass]="{ 'pec-label-error': hasError('WorkPhoneExtn') }">
                  Extn
                </label>
                <ion-input
                  type="tel"
                  formControlName="WorkPhoneExtn"
                  maxlength="4"
                  id="extnInput"
                  placeholder="____"
                ></ion-input>
              </div>
            </ion-col>
          </ion-row>
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('JobTitle') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label">Job Title</label>
                <label class="pec-input-label text-muted pec-label-error" *ngIf="hasError('JobTitle', 'required')">
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input">
                <ion-input type="text" formControlName="JobTitle" maxlength="50"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('JobStartDate') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label">Job Start Date</label>
                <label class="pec-input-label text-muted pec-label-error" *ngIf="hasError('JobStartDate', 'required')">
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input" id="open-date-picker">
                <ion-input type="text" formControlName="JobStartDate">
                  <ion-text>{{ formattedJobStartDate }}</ion-text>
                </ion-input>
              </ion-item>
              <ion-modal class="datePicker" trigger="open-date-picker" mode="md">
                <ng-template>
                  <ion-content>
                    <ion-datetime
                      color="pickerColor"
                      showDefaultButtons="true"
                      presentation="date"
                      size="cover"
                      formControlName="JobStartDate"
                      [value]="JobStartDate"
                      [(ngModel)]="JobStartDate"
                      (ngModelChange)="setFormattedJobStartDate(JobStartDate)"
                    ></ion-datetime>
                  </ion-content>
                </ng-template>
              </ion-modal>
            </ion-col>
          </ion-row>
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('HoursWorkedPerWeek') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label">Hours Worked Per Week (On Average)</label>
                <label
                  class="pec-input-label text-muted pec-label-error"
                  *ngIf="hasError('HoursWorkedPerWeek', 'required')"
                >
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input">
                <ion-input
                  type="number"
                  inputmode="numeric"
                  formControlName="HoursWorkedPerWeek"
                  min="0"
                  max="168"
                  [pecLimitTo]="3"
                ></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row [ngClass]="{ 'invalid-scroll-anchor': hasError('DailyDuties') }">
            <ion-col>
              <div class="space-between">
                <label class="pec-input-label pec-mb-0">Daily Duties</label>
                <label class="pec-input-label text-muted pec-mb-0" *ngIf="!hasError('DailyDuties', 'required')">
                  (500 character limit)
                </label>
                <label
                  class="pec-input-label text-muted pec-label-error pec-mb-0"
                  *ngIf="hasError('DailyDuties', 'required')"
                >
                  Required
                </label>
              </div>
              <ion-item class="pec-form-input">
                <ion-textarea
                  class="pec-textarea"
                  formControlName="DailyDuties"
                  maxlength="500"
                  pecAutoresize
                ></ion-textarea>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              <ion-button
                class="pec-button-grey"
                (click)="submitEmploymentDetails()"
                [pecTrackEvent]="{ category: 'Employment View', action: 'Tapped Submit Details', label: '', value: '' }"
              >
                Submit
              </ion-button>
            </ion-col>
          </ion-row>
        </form>
      </ion-grid>
    </ion-card>
  </ng-container>

  <pec-loading *ngIf="showContactLoading"></pec-loading>
  <ion-card *ngIf="!showContactLoading && contact" data-cecname="graduate-file-contact-card">
    <ion-card-header class="standard-header">
      <span>Need Help?</span>
    </ion-card-header>
    <ion-grid>
      <ion-row>
        <ion-col>
          <pec-contact-box
            [contactInfo]="contact"
            [trackEvent]="{
              category: 'Employment View',
              action: 'Tapped to View Contact',
              label: contact.ContactGroup,
              value: ''
            }"
          ></pec-contact-box>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-card>

  <ng-container *ngIf="showError">
    <pec-error-api [errCode]="errorCodeMessage"></pec-error-api>
  </ng-container>
</ion-content>
