<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button
        defaultHref=""
        class="pec-back-button"
        [text]="''"
        [icon]="''"
        (click)="onBack()"
      ></ion-back-button>
    </ion-buttons>
    <ion-title>Assignment Grade Detail</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>
  <ng-container *ngIf="assignment && !showError">
    <pec-loading *ngIf="showLoading"></pec-loading>

    <div *ngIf="!showLoading" class="assignment-details">
      <div class="header">
        <h3>{{ assignment.AssignmentName }}</h3>
        <h6 *ngIf="hasParts">(This assignment has {{ assignment.AssignmentPart.length }} parts)</h6>
      </div>

      <div *ngIf="assignment" class="round-progress-bar">
        <round-progress
          [radius]="50"
          [rounded]="true"
          [current]="currentProg"
          [max]="maxProg"
          [background]="'#E6EAEB'"
          [stroke]="8"
          [attr.aria-label]="gradeHeader + ': ' + pointsTitle + ' ' + pointsValue"
        ></round-progress>
        <div class="round-progress-text">
          <h3 [ngClass]="{ 'grade-mask-header': gradeMasked }">{{ gradeHeader }}</h3>
          <h5 class="pec-text-dark-shade">{{ pointsTitle }}</h5>
          <h6 class="pec-text-dark-shade">
            {{ pointsValue }}
            <span *ngIf="!assignment.IsExtraCredit && !gradeMasked">
              {{ (assignment.PossiblePoints > 0 ? assignment.EarnedPoints / assignment.PossiblePoints : 0) | percent:
              '1.1-1' }}
            </span>
          </h6>
        </div>
      </div>

      <ion-grid class="column-text" *ngIf="hasParts">
        <ion-row *ngFor="let part of assignmentParts">
          <ion-col size="12">
            <h2>Part {{ part.DisplayOrder }}</h2>
          </ion-col>
          <ion-col size="6">
            <span class="pec-fs-13 pec-font-default pec-text-darker-grey">Due Date</span>
            <h3 class="pec-fs-15 pec-fw-600 pec-mt-2 pec-mb-5 pec-text-dark-shade">
              {{ part.DueDate | pecDate: 'MMMM dd' }}
            </h3>
          </ion-col>
          <ion-col size="6">
            <span class="pec-fs-13 pec-font-default pec-text-darker-grey">Type</span>
            <h3 class="pec-fs-15 pec-fw-600 pec-mt-2 pec-mb-5 pec-text-dark-shade">
              {{ assignment.AssignmentTypeName }}
            </h3>
          </ion-col>
        </ion-row>
      </ion-grid>
      <ion-grid class="column-text">
        <ion-row class="feedback-parts-no-divider" *ngIf="!hasParts">
          <ion-col size="6">
            <span class="pec-fs-13 pec-font-default pec-text-darker-grey">Due Date</span>
            <h3 class="pec-fs-15 pec-fw-600 pec-mt-2 pec-mb-5 pec-text-dark-shade" *ngIf="assignment.IsCurrentYear">
              {{ assignment.DueDate | pecDate: 'MMMM d' | async }}
            </h3>
            <h3 class="pec-fs-15 pec-fw-600 pec-mt-2 pec-mb-5 pec-text-dark-shade" *ngIf="!assignment.IsCurrentYear">
              {{ assignment.DueDate | pecDate: 'MM/dd/yy' | async }}
            </h3>
          </ion-col>
          <ion-col size="6">
            <span class="pec-fs-13 pec-font-default pec-text-darker-grey">Type</span>
            <h3 class="pec-fs-15 pec-fw-600 pec-mt-2 pec-mb-5 pec-text-dark-shade">
              {{ assignment.AssignmentTypeName }}
            </h3>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <pec-loading *ngIf="showFeedbackLoading"></pec-loading>
    <ion-item
      lines="none"
      *ngIf="!showFeedbackLoading"
      class="pec-p-0 pec-mb-20"
      [ngClass]="{ 'feedback-parts-divider': hasParts, 'feedback-parts-no-divider': !hasParts }"
    >
      <ion-button
        expand="block"
        *ngIf="instructorFeedbackUrl"
        class="pec-button-grey"
        [pecTrackEvent]="{
          category: pageTrackTitle ? pageTrackTitle : 'Degree Plan View',
          action: pageTrackTitle ? 'Tapped to Access Instructor Feedback' : 'Tapped to View Completed Course Info ',
          label: pageTrackTitle ? '' : 'Feedback',
          value: '',
          classId: classId
        }"
        pecLmsRedirect
        pecOpenIn="inapp"
        pecUrl="lms/class/{{ classId }}/assignment/{{ assignmentId }}/instructorfeedback"
      >
        View Instructor Feedback
      </ion-button>
      <div *ngIf="!instructorFeedbackUrl" class="no-feedback">
        Instructor has not provided feedback for this assignment.
      </div>
    </ion-item>

    <pec-loading *ngIf="showAttachmentLoading"></pec-loading>
    <ion-list *ngIf="assignmentDetail && !showAttachmentLoading" class="assignment-attachments">
      <ion-item class="pec-text-primary pec-fs-20 fw-400 pec-font-oswald pec-text-tr-up attachments-title">
        Attachments
      </ion-item>
      <ion-item
        lines="none"
        class="pec-text-darker-grey pec-fs-14 pec-fs-default no-attachments"
        *ngIf="!attachments || attachments.length == 0"
      >
        There are no attachments for this assignment.
      </ion-item>
      <ion-item class="attachment pec-mt-13 pec-mb-3" *ngFor="let attachment of attachments">
        <div
          pecUrlRedirect
          pecOpenIn="browser"
          [pecUrl]="attachment.attachmentUrl"
          [pecTrackEvent]="{
            category: pageTrackTitle ? pageTrackTitle : 'Degree Plan View',
            action: pageTrackTitle ? 'Tapped to Access Instructor File' : 'Tapped to View Completed Course Info ',
            label: pageTrackTitle ? '' : 'Attachments',
            value: '',
            classId: classId
          }"
        >
          <div class="pec-text-black pec-fs-16 pec-mt-2 pec-mb-3 attachment-title">{{ attachment.Title }}</div>
          <div *ngIf="attachment.isCurrentYear" class="attachment-created-date">
            {{ attachment.CreateDate | pecDate: 'MMMM dd hh:mm a' | async }}
          </div>
          <div *ngIf="!attachment.isCurrentYear" class="attachment-created-date">
            {{ attachment.CreateDate | pecDate: 'MM/dd/yy' | async }}
          </div>
        </div>
      </ion-item>
    </ion-list>
  </ng-container>
  <ng-container *ngIf="showError">
    <pec-error-api [errCode]="errCode"></pec-error-api>
  </ng-container>
</ion-content>
